!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Recorder=t():e.Recorder=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={sampleBits:[8,16].includes(t.sampleBits)?t.sampleBits:16,sampleRate:[11025,22050,24e3,44100,48e3].includes(t.sampleRate)?t.sampleRate:16e3,numChannels:[1,2].includes(t.sampleBits)?t.sampleBits:1},this.size=0,this.buffer=[],this.PCMData=null}var t,n,i;return t=e,(n=[{key:"ready",value:function(){var t=this;return this.context=new(window.AudioContext||window.webkitAudioContext),this.createScript=this.context.createScriptProcessor||this.context.createJavaScriptNode,this.recorder=this.createScript.apply(this.context,[4096,1,1]),this.recorder.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0);t.buffer.push(new Float32Array(n)),t.size+=n.length},navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){t.audioInput=t.context.createMediaStreamSource(e)},function(t){switch(t.code||t.name){case"PERMISSION_DENIED":case"PermissionDeniedError":e.throwError("用户拒绝提供信息。");break;case"NOT_SUPPORTED_ERROR":case"NotSupportedError":e.throwError("浏览器不支持硬件设备。");break;case"MANDATORY_UNSATISFIED_ERROR":case"MandatoryUnsatisfiedError":e.throwError("无法发现指定的硬件设备。");break;default:e.throwError("无法打开麦克风。异常信息:"+(t.code||t.name))}})}},{key:"clear",value:function(){this.buffer.length=0,this.size=0,this.PCMData=null,this.source&&(this.source.disconnect(),this.source=null)}},{key:"throwError",value:function(e){throw new Error(e)}},{key:"start",value:function(){this.clear(),this.audioInput.connect(this.recorder),this.recorder.connect(this.context.destination),this.inputSampleRate=this.context.sampleRate,this.inputSampleBits=16,this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits}},{key:"stop",value:function(){this.recorder.disconnect()}},{key:"play",value:function(){return this.source=context.createBufferSource(),this.source.buffer=this.encodePCM().buffer,this.source.connect(context.destination),this.source.start(),window.URL.createObjectURL(this.getWAVBlob())}},{key:"destory",value:function(){this.clear()}},{key:"getPCM",value:function(){return this.stop(),this.PCMData||(this.PCMData=this.encodePCM())}},{key:"getPCMBlob",value:function(){return new Blob([this.getPCM()])}},{key:"getWAV",value:function(){return this.stop(),this.encodeWAV()}},{key:"getWAVBlob",value:function(){return new Blob([this.getWAV()],{type:"audio/wav"})}},{key:"compress",value:function(){for(var e=new Float32Array(this.size),t=0,n=0;n<this.buffer.length;n++)e.set(this.buffer[n],t),t+=this.buffer[n].length;for(var r=parseInt(this.inputSampleRate/this.outputSampleRate)||1,i=e.length/r,o=new Float32Array(i),a=0,s=0;a<i;)o[a]=e[s],s+=r,a++;return o}},{key:"encodePCM",value:function(){var e=this.compress(),t=Math.min(this.inputSampleBits,this.oututSampleBits),n=0,r=e.length*(t/8),i=new ArrayBuffer(r),o=new DataView(i);if(8===t)for(var a=0;a<e.length;a++,n++){var s=(u=Math.max(-1,Math.min(1,e[a])))<0?128*u:127*u;s=parseInt(s+128),o.setInt8(n,s,!0)}else for(a=0;a<e.length;a++,n+=2){var u=Math.max(-1,Math.min(1,e[a]));o.setInt16(n,u<0?32768*u:32767*u,!0)}return o}},{key:"encodeWAV",value:function(){var e=Math.min(this.inputSampleRate,this.outputSampleRate),t=Math.min(this.inputSampleBits,this.oututSampleBits),n=this.encodePCM(),r=new ArrayBuffer(44),i=new DataView(r),a=0;return o(i,a,"RIFF"),a+=4,i.setUint32(a,36+n.byteLength,!0),o(i,a+=4,"WAVE"),o(i,a+=4,"fmt "),a+=4,i.setUint32(a,16,!0),a+=4,i.setUint16(a,1,!0),a+=2,i.setUint16(a,1,!0),a+=2,i.setUint32(a,e,!0),a+=4,i.setUint32(a,1*e*(t/8),!0),a+=4,i.setUint16(a,t/8*1,!0),a+=2,i.setUint16(a,t,!0),o(i,a+=2,"data"),a+=4,i.setUint32(a,n.byteLength,!0),a+=4,i=function(e){for(var t=0,n=0,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(var a=0,s=i;a<s.length;a++){var u=s[a];t+=u.length||u.byteLength}for(var c=new ArrayBuffer(t),l=new e(c),f=0,h=i;f<h.length;f++)for(var p=h[f],d=0,y=p.byteLength;d<y;++d)l.setInt8(n,p.getInt8(d)),n+=1;return l}(DataView,i,n)}}])&&r(t.prototype,n),i&&r(t,i),e}();function o(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}t.default=i}]).default});